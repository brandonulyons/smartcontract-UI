const bel = require("bel")
const date = require('getDate')
const shortenHexData = require('shortenHexData')
const copy = require('copy-text-to-clipboard')
const moreInfo = require('moreInfo')
const getReturnData = require('getReturnData')

module.exports = makeReturn

async function makeReturn (css, contract, solcMetadata, provider, transaction, fnName) {
  var decodedTx
  var data
  var opts
  var el = bel`<div class=${css.txReturnItem}></div>`
  var opts = { contract, fnName, solcMetadata}
  if (transaction.hash) {  // nonpayable and payable
    opts.receipt = await transaction.wait()
    opts.data = transaction.data
    opts.tag = 'input'
    data = getReturnData(opts)
    el.appendChild(moreInfo(provider._network.name, transaction.hash))
  } else { // view and pure
    opts.transaction = transaction
    opts.tag = 'output'
    data = getReturnData(opts)
  }
  el.appendChild(makeTxReturn(css, data))
  return el
}

function makeTxReturn (css, data) {
  return bel`
    <div class=${css.txReceipt}>
        <div class=${css.txReturnField}>
          <div class=${css.txReturnValue}>${JSON.stringify(data, null, 2)}</div>
        </div>
    </div>`
}
